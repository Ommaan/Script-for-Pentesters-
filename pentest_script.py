import sys
import subprocess
import hashlib
import socket

def scan_ports(target, start_port, end_port):
    print(f"Scanning ports {start_port}-{end_port} on {target}...")
    try:
        for port in range(start_port, end_port+1):
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            result = sock.connect_ex((target, port))
            if result == 0:
                print(f"Port {port} is open")
            sock.close()
    except socket.gaierror:
        print("Hostname could not be resolved. Exiting...")
        sys.exit()
    except socket.error:
        print("Could not connect to the server. Exiting...")
        sys.exit()

def crack_hash(hash_type, hash_value, wordlist):
    print(f"Cracking {hash_type} hash '{hash_value}'...")
    try:
        if hash_type == 'md5':
            algorithm = hashlib.md5()
        elif hash_type == 'sha1':
            algorithm = hashlib.sha1()
        elif hash_type == 'sha256':
            algorithm = hashlib.sha256()
        else:
            print("Invalid hash type. Exiting...")
            sys.exit()

        with open(wordlist, 'r', errors='ignore') as file:
            for word in file:
                word = word.strip()
                algorithm.update(word.encode('utf-8'))
                hashed_word = algorithm.hexdigest()
                if hashed_word == hash_value:
                    print(f"Password found: {word}")
                    return

        print("Password not found in the wordlist.")
    except FileNotFoundError:
        print(f"Wordlist file '{wordlist}' not found. Exiting...")
        sys.exit()

def enumerate_services(target):
    print(f"Enumerating services on {target}...")
    try:
        cmd = f"nmap -Pn -p- {target}"
        result = subprocess.check_output(cmd, shell=True, universal_newlines=True)
        print(result)
    except subprocess.CalledProcessError:
        print("Error occurred while enumerating services. Exiting...")
        sys.exit()

def main():
    print("Penetration Testing Automation Script")
    print("Choose an option:")
    print("1. Port Scanner")
    print("2. Hash Cracker")
    print("3. Enumerate Services")
    choice = input("Enter your choice (1-3): ")

    target = input("Enter the target IP address: ")

    if choice == '1':
        start_port = int(input("Enter the starting port: "))
        end_port = int(input("Enter the ending port: "))
        scan_ports(target, start_port, end_port)
    elif choice == '2':
        hash_type = input("Enter the hash type (md5, sha1, sha256): ")
        hash_value = input("Enter the hash value: ")
        wordlist = input("Enter the wordlist file: ")
        crack_hash(hash_type, hash_value, wordlist)
    elif choice == '3':
        enumerate_services(target)
    else:
        print("Invalid choice. Exiting...")
        sys.exit()

if __name__ == "__main__":
    main()
